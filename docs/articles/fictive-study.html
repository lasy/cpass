<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using the `cpass` package on study data • cpass</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using the `cpass` package on study data">
<meta property="og:description" content="cpass">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cpass</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cpass_vignette.html">Introduction to the `cpass` package</a>
    </li>
    <li>
      <a href="../articles/fictive-study.html">Using the `cpass` package on study data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using the <code>cpass</code> package on study
data</h1>
            
      
      
      <div class="hidden name"><code>fictive-study.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lasy.github.io/cpass/" class="external-link">cpass</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># viz options</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="co"># for reproducibility</span></span></code></pre></div>
<p>In this vignette, we simulate, then analyze, data in the context of a
fictive study. This fictive study aims at evaluating the efficacy of a
new treatment and comparing it to a placebo.</p>
<div class="section level2">
<h2 id="study-design">Study design<a class="anchor" aria-label="anchor" href="#study-design"></a>
</h2>
<ul>
<li><p><strong>Recruitment</strong>: patients complaining about
(worsening of) symptoms in their luteal phase</p></li>
<li><p><strong>Pre-enrollment phase</strong>: participants are asked to
report their DRSP for two cycles</p></li>
<li><p><strong>Inclusion criteria</strong>: participants must meet
diagnosis for PMDD</p></li>
<li><p><strong>Study phase</strong>: 50% of the participants are given
the new treatment, rest is given a placebo. After 3 cycles of treatment,
participants are asked to report their DRSP again for two
cycles.</p></li>
<li><p><strong>Analysis</strong>: we evaluate the benefit of the new
treatment compared to the placebo.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="simulating-pre-enrollment-data">Simulating pre-enrollment data<a class="anchor" aria-label="anchor" href="#simulating-pre-enrollment-data"></a>
</h2>
<p>Here, we simulate data for 240 subjects. These data are simulated
such that each subject has a specific level symptoms at baseline,
specific levels of symptoms worsening in their pre-menstrual week, and a
specific number of items (symptoms) worsening in their pre-menstrual
phase. They are simulated such that some, but not all, subjects meet
criteria for PMDD. This is what would be expected in an actual study
during the screening (and prospective validation) phase.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># we simulate data for 240 subjects</span></span>
<span><span class="va">n_subjects</span> <span class="op">=</span> <span class="fl">240</span></span>
<span></span>
<span><span class="co"># the simulate_cpass_data function is part of the cpass package</span></span>
<span><span class="co"># type "?simulate_cpass_data" for documentation</span></span>
<span><span class="va">pre_data</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/simulate_cpass_data.html">simulate_cpass_data</a></span><span class="op">(</span></span>
<span>    n_subjects <span class="op">=</span> <span class="va">n_subjects</span>,</span>
<span>    <span class="co"># we simulate 2 cycles for each subject</span></span>
<span>    n_cycles <span class="op">=</span> <span class="fl">2</span>, </span>
<span>    <span class="co"># baseline for each subject</span></span>
<span>    baseline <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_subjects</span>, mean <span class="op">=</span> <span class="fl">2</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>    <span class="co"># % increase in symptoms</span></span>
<span>    pmdd_intensity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_subjects</span>, mean <span class="op">=</span> <span class="fl">0.35</span>, sd <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span>, </span>
<span>    <span class="co"># number of items that vary in the pre-menstrual phase</span></span>
<span>    n_items <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, <span class="va">n_subjects</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                     prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, mean <span class="op">=</span> <span class="fl">15</span>, sd <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="co"># fraction of days without data (e.g. participants forgot to report)</span></span>
<span>    missingness_rate <span class="op">=</span> <span class="fl">0.2</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># write_csv(pre_data, "data/pre_data.csv") </span></span>
<span><span class="co"># The function above exports data into a .csv file.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="analysis-of-pre-enrollment-data-and-identifying-pmdd-patients-">Analysis of pre-enrollment data and identifying PMDD patients.<a class="anchor" aria-label="anchor" href="#analysis-of-pre-enrollment-data-and-identifying-pmdd-patients-"></a>
</h2>
<p>Before applying the <code>cpass</code> function on our data, we first
need to format the data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># pre_data &lt;- </span></span>
<span><span class="co">#  read_csv("data/pre_data.csv",</span></span>
<span><span class="co">#           show_col_types = FALSE)</span></span>
<span></span>
<span><span class="co"># to do a quick exploration of these data, try</span></span>
<span><span class="co"># View(pre_data)</span></span>
<span><span class="co"># head(pre_data)</span></span>
<span><span class="co"># summary(pre_data)</span></span>
<span></span>
<span><span class="co"># below, we transform the data into a "long" table</span></span>
<span><span class="co"># where there is one row per subject x cycle x cycleday x item</span></span>
<span><span class="va">pre_data_long</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">pre_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"item_"</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"item"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"drsp_score"</span>,</span>
<span>               names_prefix <span class="op">=</span> <span class="st">"item_"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>item <span class="op">=</span> <span class="va">item</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># finally, we use the `as_cpass_data` function, which checks the data</span></span>
<span><span class="co"># and prepare them for the `cpass` function (see next chunk)</span></span>
<span><span class="va">pre_data_cpass_format</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/as_cpass_data.html">as_cpass_data</a></span><span class="op">(</span><span class="va">pre_data_long</span>, sep_event <span class="op">=</span> <span class="st">"ovulation"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of subjects:  240 </span></span>
<span><span class="co">#&gt; Total number of cycles:  480 </span></span>
<span><span class="co">#&gt; Percentage of missing scores:  20.31 %</span></span>
<span><span class="co">#&gt; Percentage of missing scores</span></span>
<span><span class="co">#&gt;           (in pre- &amp; post-menstrual phases):  20.31 %</span></span></code></pre></div>
<p>Now that data are formatted, we can apply the <code>cpass</code>
function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">pre_data_cpass</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/cpass.html">cpass</a></span><span class="op">(</span><span class="va">pre_data_cpass_format</span><span class="op">)</span></span>
<span><span class="co">#&gt; PME diagnosis is still experimental and has not been validated clinically. Please, use with caution.</span></span></code></pre></div>
<p>The first thing we can check is the number of participants that meet
the PMDD criteria. The table below shows the number of participants with
no diagnosis, a MRMD, PMDD or a PME diagnosis.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">pre_data_cpass</span><span class="op">$</span><span class="va">subject_level_diagnosis</span><span class="op">$</span><span class="va">dx</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">.</th>
<th align="right">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">no diagnosis</td>
<td align="right">92</td>
</tr>
<tr class="even">
<td align="left">MRMD</td>
<td align="right">30</td>
</tr>
<tr class="odd">
<td align="left">PMDD</td>
<td align="right">68</td>
</tr>
<tr class="even">
<td align="left">PME</td>
<td align="right">20</td>
</tr>
</tbody>
</table>
<p>We can also plot the distribution of average percent change for one
of the items for all participants, grouping them by diagnosis.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">pre_data_cpass</span><span class="op">$</span><span class="va">summary_item</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">item</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    <span class="va">.</span>, </span>
<span>    <span class="va">pre_data_cpass</span><span class="op">$</span><span class="va">subject_level_diagnosis</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"subject"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ave_perc_change</span>, fill <span class="op">=</span> <span class="va">dx</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"identity"</span>, alpha <span class="op">=</span> <span class="fl">0.4</span>, binwidth <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Average % change for item 1"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">dx</span> <span class="op">~</span> <span class="va">.</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>strip.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">0</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="fictive-study_files/figure-html/distribution-of-symptom-increase-1.png" width="576"></p>
<p>We see that not all PMDD participant have a 30% increase in symptoms
for the 1st item. These participants have a 30+% increase in other
items.</p>
<p>We can also plot the item summary and reported data for specific
participants. Here, we show the subject’s data visualization for two
subjects: one that meets the PMDD diagnosis criteria, and one that does
not meet any criteria.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">get_random_subject</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">subjects_data</span>, <span class="va">diagnosis</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">subjects_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dx</span> <span class="op">==</span> <span class="va">diagnosis</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">subject</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html" class="external-link">sample_n</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">pmdd_subject</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">get_random_subject</span><span class="op">(</span><span class="va">pre_data_cpass</span><span class="op">$</span><span class="va">subject_level_diagnosis</span>, <span class="st">"PMDD"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">no_dx_subject</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">get_random_subject</span><span class="op">(</span><span class="va">pre_data_cpass</span><span class="op">$</span><span class="va">subject_level_diagnosis</span>, <span class="st">"no diagnosis"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_subject_data_and_dx.html">plot_subject_data_and_dx</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">pre_data_cpass_format</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subject</span> <span class="op">==</span> <span class="va">pmdd_subject</span><span class="op">)</span>,</span>
<span>  save_as_pdf <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; PME diagnosis is still experimental and has not be validated clinically. Please, use with caution.</span></span></code></pre></div>
<p><img src="fictive-study_files/figure-html/checking-data-from-specific-subjects-full-viz-1.png" width="960"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/plot_subject_data_and_dx.html">plot_subject_data_and_dx</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">pre_data_cpass_format</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subject</span> <span class="op">==</span> <span class="va">no_dx_subject</span><span class="op">)</span>,</span>
<span>  save_as_pdf <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; PME diagnosis is still experimental and has not be validated clinically. Please, use with caution.</span></span></code></pre></div>
<p><img src="fictive-study_files/figure-html/checking-data-from-specific-subjects-full-viz-2.png" width="960"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">mrmd_subject</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">get_random_subject</span><span class="op">(</span><span class="va">pre_data_cpass</span><span class="op">$</span><span class="va">subject_level_diagnosis</span>, <span class="st">"MRMD"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_subject_dx.html">plot_subject_dx</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">pre_data_cpass_format</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subject</span> <span class="op">==</span> <span class="va">mrmd_subject</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="fictive-study_files/figure-html/checking-data-from-specific-subjects-dx-and-cycle-viz-1.png" width="960"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/plot_subject_cycle_obs.html">plot_subject_cycle_obs</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> </span>
<span>    <span class="va">pre_data_cpass_format</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subject</span> <span class="op">==</span> <span class="va">mrmd_subject</span>,</span>
<span>           <span class="va">cycle</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; PME diagnosis is still experimental and has not be validated clinically. Please, use with caution.</span></span></code></pre></div>
<p><img src="fictive-study_files/figure-html/checking-data-from-specific-subjects-dx-and-cycle-viz-2.png" width="960"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/plot_subject_cycle_obs.html">plot_subject_cycle_obs</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> </span>
<span>    <span class="va">pre_data_cpass_format</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subject</span> <span class="op">==</span> <span class="va">mrmd_subject</span>,</span>
<span>           <span class="va">cycle</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; PME diagnosis is still experimental and has not be validated clinically. Please, use with caution.</span></span></code></pre></div>
<p><img src="fictive-study_files/figure-html/checking-data-from-specific-subjects-dx-and-cycle-viz-3.png" width="960"></p>
</div>
<div class="section level2">
<h2 id="inclusion-criteria-and-random-selection-into-study-arms">Inclusion criteria and random selection into study arms<a class="anchor" aria-label="anchor" href="#inclusion-criteria-and-random-selection-into-study-arms"></a>
</h2>
<p>Here we select the participants who meet PMDD criteria and we
randomly assign them to one of the two study arms (treatment or
placebo)</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">subjects_with_pmdd</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">pre_data_cpass</span><span class="op">$</span><span class="va">subject_level_diagnosis</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dx</span> <span class="op">==</span> <span class="st">"PMDD"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">avgdsm5crit</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>study_arm <span class="op">=</span> </span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span></span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"placebo"</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"treatment"</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             size <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">subjects_with_pmdd</span><span class="op">$</span><span class="va">study_arm</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">.</th>
<th align="right">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">placebo</td>
<td align="right">34</td>
</tr>
<tr class="even">
<td align="left">treatment</td>
<td align="right">34</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">subjects_with_pmdd</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">subjects_with_pmdd</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">study_arm</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">study_arm</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>subject_nb <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulating-study-data-post-treatment">Simulating study data (post-treatment)<a class="anchor" aria-label="anchor" href="#simulating-study-data-post-treatment"></a>
</h2>
<p>In this section, we simulate the study data. We simulate these data
such that participants in the “treatment” arm experience lower increase
in symptoms in their pre-menstrual week and less symptoms with increased
severity than those in the “placebo” arm.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">n_placebo</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">subjects_with_pmdd</span><span class="op">$</span><span class="va">study_arm</span> <span class="op">==</span> <span class="st">"placebo"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">post_placebo</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/simulate_cpass_data.html">simulate_cpass_data</a></span><span class="op">(</span></span>
<span>    n_subjects <span class="op">=</span> <span class="va">n_placebo</span>,</span>
<span>    n_cycles <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    pmdd_intensity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_placebo</span>, mean <span class="op">=</span> <span class="fl">0.5</span>, sd <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span>,</span>
<span>    baseline <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_placebo</span>, mean <span class="op">=</span> <span class="fl">1</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    n_items <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, <span class="va">n_placebo</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                     prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, mean <span class="op">=</span> <span class="fl">15</span>, sd <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    missingness_rate <span class="op">=</span> <span class="fl">0.1</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>subject_nb <span class="op">=</span> <span class="va">subject</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>study_arm <span class="op">=</span> <span class="st">"placebo"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    <span class="va">.</span>, </span>
<span>    <span class="va">subjects_with_pmdd</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">study_arm</span> <span class="op">==</span> <span class="st">"placebo"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">subject_nb</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"subject_nb"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n_treatment</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">subjects_with_pmdd</span><span class="op">$</span><span class="va">study_arm</span> <span class="op">==</span> <span class="st">"treatment"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">post_treatment</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/simulate_cpass_data.html">simulate_cpass_data</a></span><span class="op">(</span></span>
<span>    n_subjects <span class="op">=</span> <span class="va">n_treatment</span>,</span>
<span>    n_cycles <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    pmdd_intensity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n_treatment</span>, mean <span class="op">=</span> <span class="fl">0.2</span>, sd <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span>,</span>
<span>    baseline <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_treatment</span>, mean <span class="op">=</span> <span class="fl">1</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    n_items <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, <span class="va">n_treatment</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                     prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">24</span>, mean <span class="op">=</span> <span class="fl">8</span>, sd <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,    </span>
<span>    missingness_rate <span class="op">=</span> <span class="fl">0.1</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>subject_nb <span class="op">=</span> <span class="va">subject</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>study_arm <span class="op">=</span> <span class="st">"treatment"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    <span class="va">.</span>, </span>
<span>    <span class="va">subjects_with_pmdd</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">study_arm</span> <span class="op">==</span> <span class="st">"treatment"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">subject_nb</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"subject_nb"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">study_data</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="va">post_placebo</span>,</span>
<span>    <span class="va">post_treatment</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># write_csv(study_data, "data/study_data.csv") # save the data as csv file</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="analysing-study-results">Analysing study results<a class="anchor" aria-label="anchor" href="#analysing-study-results"></a>
</h2>
<p>Similarly as for the screening data, we first format the study
data.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#study_data &lt;- </span></span>
<span><span class="co">#  read_csv("data/study_data.csv",</span></span>
<span><span class="co">#           show_col_types = FALSE)</span></span>
<span></span>
<span><span class="co"># to do a quick exploration of these data, try</span></span>
<span><span class="co"># View(study_data)</span></span>
<span><span class="co"># head(study_data)</span></span>
<span><span class="co"># summary(study_data)</span></span>
<span></span>
<span><span class="co"># below, we transform the data into a "long" table</span></span>
<span><span class="co"># where there is one row per subject x cycle x cycleday x item</span></span>
<span><span class="va">study_data_long</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">study_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"item_"</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"item"</span>,</span>
<span>               values_to <span class="op">=</span> <span class="st">"drsp_score"</span>,</span>
<span>               names_prefix <span class="op">=</span> <span class="st">"item_"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>item <span class="op">=</span> <span class="va">item</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># finally, we use the `as_cpass_data` function, which checks the data</span></span>
<span><span class="co"># and prepare them for the `cpass` function (see next chunk)</span></span>
<span><span class="va">study_data_cpass_format</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/as_cpass_data.html">as_cpass_data</a></span><span class="op">(</span><span class="va">study_data_long</span>, sep_event <span class="op">=</span> <span class="st">"ovulation"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of subjects:  68 </span></span>
<span><span class="co">#&gt; Total number of cycles:  136 </span></span>
<span><span class="co">#&gt; Percentage of missing scores:  10.29 %</span></span>
<span><span class="co">#&gt; Warning in as_cpass_data(study_data_long, sep_event = "ovulation"): The 'phase' column will be over-written</span></span>
<span><span class="co">#&gt; Percentage of missing scores</span></span>
<span><span class="co">#&gt;           (in pre- &amp; post-menstrual phases):  10.29 %</span></span></code></pre></div>
<p>Now that data are formatted, we can apply the <code>cpass</code>
function.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">study_data_cpass</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/cpass.html">cpass</a></span><span class="op">(</span><span class="va">study_data_cpass_format</span><span class="op">)</span></span>
<span><span class="co">#&gt; PME diagnosis is still experimental and has not been validated clinically. Please, use with caution.</span></span></code></pre></div>
<p>We can now check the number of participants that still meet PMDD
criteria in the two study arms</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">subject_dx_study_cycles</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">study_data_cpass</span><span class="op">$</span><span class="va">subject_level_diagnosis</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">subjects_with_pmdd</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">study_arm</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"subject"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">subject_dx_study_cycles</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">study_arm</span>, <span class="va">dx</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">study_arm</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>perc <span class="op">=</span> <span class="op">(</span><span class="va">n</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">study_arm</span>, <span class="va">dx</span>, <span class="va">perc</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">study_arm</span>, <span class="va">dx</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span></span>
<span>    id_cols <span class="op">=</span> <span class="va">study_arm</span>,</span>
<span>    names_from <span class="op">=</span> <span class="va">dx</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">perc</span>,</span>
<span>    names_prefix  <span class="op">=</span> <span class="st">"% "</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">study_arm</th>
<th align="right">% no diagnosis</th>
<th align="right">% MRMD</th>
<th align="right">% PMDD</th>
<th align="right">% NA</th>
<th align="right">% PME</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">placebo</td>
<td align="right">41.18</td>
<td align="right">11.76</td>
<td align="right">44.12</td>
<td align="right">2.94</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">treatment</td>
<td align="right">70.59</td>
<td align="right">14.71</td>
<td align="right">11.76</td>
<td align="right">NA</td>
<td align="right">2.94</td>
</tr>
</tbody>
</table>
<p>As expected/designed, the fraction of participants diagnosed with
PMDD following the treatment is lower than following the placebo. And as
expected/designed, the percentage of participants with PMDD in the
placebo arm is still lower than after recruitment (where it was
100%).</p>
<p>We can continue the analysis by asking if the treatment is especially
effective at reducing specific symptoms?</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">item_summary_study</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">study_data_cpass</span><span class="op">$</span><span class="va">summary_item</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    <span class="va">subjects_with_pmdd</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">study_arm</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"subject"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">item_summary_pre</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">pre_data_cpass</span><span class="op">$</span><span class="va">summary_item</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subject</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">subjects_with_pmdd</span><span class="op">$</span><span class="va">subject</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>ave_perc_change_baseline <span class="op">=</span> <span class="va">ave_perc_change</span><span class="op">)</span></span>
<span></span>
<span><span class="va">item_summary</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">item_summary_study</span>, <span class="va">item_summary_pre</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"subject"</span>, <span class="st">"item"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">study_arm</span>, <span class="va">subject</span>, <span class="va">item</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">study_arm</span>, <span class="va">subject</span>, <span class="va">item</span>, <span class="va">ave_perc_change_baseline</span>, <span class="va">ave_perc_change</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># item_summary</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">item_summary</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ave_perc_change</span> <span class="op">-</span> <span class="va">ave_perc_change_baseline</span>,</span>
<span>           fill <span class="op">=</span> <span class="va">study_arm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"identity"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, binwidth <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">item</span> <span class="op">~</span> <span class="va">.</span>, ncol <span class="op">=</span> <span class="fl">6</span>, labeller <span class="op">=</span> <span class="va">label_both</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Difference (baseline - study) in average % change in reported severity\nbetween the pre- and the post-menstrual phase"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_fill_discrete</a></span><span class="op">(</span><span class="st">"Study arm"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fictive-study_files/figure-html/symptom-reduction-1.png" width="700"></p>
<p>Because we simulated the data, we know that the treatment is not
expected to reduce specific symtpoms. The visualizatio above seems to
confirm this expectation.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Laura Symul, Tory Eisenlohr-Moul.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
